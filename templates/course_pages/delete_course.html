{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container course-create-container">
  <div class="course-create-card">
    <!-- Header Section -->
    <div class="create-header">
      <h1><i class="fas fa-plus-circle"></i> Create New Course</h1>
      <p>Fill in the details to create your amazing course</p>
    </div>

    <form action="{% url 'course:create-course' %}" method='POST' enctype="multipart/form-data">
      {% csrf_token %}

      <!-- Display form-level errors -->
      {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
        <p>{{ error }}</p>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Basic Information Section -->
      <div class="form-section">
        <h2><i class="fas fa-info-circle"></i> Course Information</h2>

        <!-- Title Field -->
        <div class="form-group">
          <label for="id_title">Title*</label>
          <input type="text" name="title" class="form-control {% if form.title.errors %}is-invalid{% endif %}"
            placeholder="Course Title" required id="id_title" value="{{ form.title.value|default_if_none:'' }}">
          {% if form.title.errors %}
          <div class="invalid-feedback">
            {% for error in form.title.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Description Field -->
        <div class="form-group">
          <label for="id_description">Description*</label>
          <textarea name="description" class="form-control {% if form.description.errors %}is-invalid{% endif %}"
            placeholder="Course Description" required id="id_description"
            rows="4">{{ form.description.value|default_if_none:'' }}</textarea>
          {% if form.description.errors %}
          <div class="invalid-feedback">
            {% for error in form.description.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Requirements Field -->
        <div class="form-group">
          <label for="id_requirements">Requirements</label>
          <textarea name="requirements" class="form-control {% if form.requirements.errors %}is-invalid{% endif %}"
            placeholder="Course Requirements" id="id_requirements"
            rows="3">{{ form.requirements.value|default_if_none:'' }}</textarea>
          {% if form.requirements.errors %}
          <div class="invalid-feedback">
            {% for error in form.requirements.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Category Field -->
        <div class="form-group">
          <label for="id_category">Category*</label>
          <select name="category" class="form-control {% if form.category.errors %}is-invalid{% endif %}" required
            id="id_category">
            {% for value, label in form.category.field.choices %}
            <option value="{{ value }}" {% if form.category.value==value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          {% if form.category.errors %}
          <div class="invalid-feedback">
            {% for error in form.category.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Media Upload Section -->
      <div class="form-section">
        <h2><i class="fas fa-images"></i> Course Media</h2>

        <!-- Image Upload Card -->
        <div class="upload-card">
          <div class="upload-header">
            <i class="fas fa-image"></i>
            <h3>Course Thumbnail</h3>
          </div>
          <div class="upload-body">
            <label class="file-upload-label">
              <input type="file" name="image" class="d-none {% if form.image.errors %}is-invalid{% endif %}"
                accept="image/*" id="id_image">
              <div class="file-upload-design">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload thumbnail image</p>
                <span class="file-info">Recommended: 1200Ã—800 pixels (JPG/PNG)</span>
              </div>
              {% if form.image.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.image.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <div id="image-preview" class="preview-container"></div>
            </label>
          </div>
        </div>

        <!-- Video Upload Card -->
        <div class="upload-card">
          <div class="upload-header">
            <i class="fas fa-video"></i>
            <h3>Promotional Video</h3>
          </div>
          <div class="upload-body">
            <label class="file-upload-label">
              <input type="file" name="promo_video" class="d-none {% if form.promo_video.errors %}is-invalid{% endif %}"
                accept="video/*" id="id_promo_video">
              <div class="file-upload-design">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload promo video</p>
                <span class="file-info">Recommended: MP4 format, under 2 minutes</span>
              </div>
              {% if form.promo_video.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.promo_video.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
              <div id="video-preview" class="preview-container"></div>
            </label>
          </div>
        </div>
      </div>

      <!-- Pricing Section -->
      <div class="form-section">
        <h2><i class="fas fa-tag"></i> Pricing</h2>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="id_price">Price ($)</label>
              <input type="number" name="price" class="form-control {% if form.price.errors %}is-invalid{% endif %}"
                placeholder="Course Price" step="0.01" id="id_price" value="{{ form.price.value|default_if_none:'' }}"
                {% if form.is_free.value %}disabled{% endif %}>
              {% if form.price.errors %}
              <div class="invalid-feedback">
                {% for error in form.price.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="id_discount_price">Discount Price ($)</label>
              <input type="number" name="discount_price"
                class="form-control {% if form.discount_price.errors %}is-invalid{% endif %}"
                placeholder="Discount Price" step="0.01" id="id_discount_price"
                value="{{ form.discount_price.value|default_if_none:'' }}" {% if form.is_free.value %}disabled{% endif
                %}>
              {% if form.discount_price.errors %}
              <div class="invalid-feedback">
                {% for error in form.discount_price.errors %}
                {{ error }}
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="form-group form-check">
          <input type="checkbox" name="is_free" class="form-check-input" id="id_is_free" {% if form.is_free.value
            %}checked{% endif %}>
          <label class="form-check-label" for="id_is_free">This course is free</label>
          {% if form.is_free.errors %}
          <div class="invalid-feedback d-block">
            {% for error in form.is_free.errors %}
            {{ error }}
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <button type="submit" class="create-course-btn">
          <i class="fas fa-save"></i> Create Course
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  /* Add this to your existing CSS */
  .alert-danger {
    background-color: #FEE2E2;
    border-color: #FECACA;
    color: #B91C1C;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
  }

  .alert-danger p {
    margin: 0;
  }

  .is-invalid {
    border-color: #DC2626;
  }

  .invalid-feedback {
    color: #DC2626;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }
</style>

<script>
  // Previous JavaScript remains the same, just add this:
  document.addEventListener('DOMContentLoaded', function () {
    // Free course checkbox functionality
    const isFreeCheckbox = document.getElementById('id_is_free');
    const priceField = document.getElementById('id_price');
    const discountField = document.getElementById('id_discount_price');

    function togglePriceFields() {
      if (isFreeCheckbox.checked) {
        priceField.disabled = true;
        discountField.disabled = true;
        priceField.value = '';
        discountField.value = '';
      } else {
        priceField.disabled = false;
        discountField.disabled = false;
      }
    }

    // Initialize on load
    togglePriceFields();

    // Add event listener
    isFreeCheckbox.addEventListener('change', togglePriceFields);

    // Rest of your existing JavaScript...
  });
</script>
{% endblock %}